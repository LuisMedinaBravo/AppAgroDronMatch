<!DOCTYPE html>
<html lang="en">

<head>
    <title>Zay Shop eCommerce HTML CSS Template</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1.0, user-scalable=no, orientation-lock=portrait" >

    <link rel="shortcut icon" type="image/x-icon" href="../../img/favicon.ico">

    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/templatemo.css">
    <link rel="stylesheet" href="../../css/custom.css">

    <!-- Load fonts style after rendering the layout styles -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap">
    <link rel="stylesheet" href="../../css/fontawesome.min.css">
<!--
    
TemplateMo 559 Zay Shop

https://templatemo.com/tm-559-zay-shop

-->
</head>

<body class="animate-section" style="overflow: hidden;">

    <!-- Start Banner Hero -->
    <div id="template-mo-zay-hero-carousel" class="carousel slide" style="height: 20vh;">
        <div class="carousel-inner">
            <div id="carousel-active" class="carousel-item active" style="height: 20vh; background-image: url('../../img/DJI_0188.jpg'); background-size: cover; background-position: center;">
                <div class="container" style="height: 100%;">
                    <div class="row align-items-end justify-content-center h-100">
                        <div class="col-lg-6 mb-0 d-flex justify-content-center">
                            <div>
                                <h1 class="h1 text-success" style="color: white !important; margin-bottom: 0.5rem;"><b>AgroDronMatch</b></h1>
                                <h4 class="h4" style="color: white !important; text-align: center;"><b>Paso 4: Datos disp. aplicación</b></h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flecha-atras">
                    <i class="fas fa-chevron-left"></i>
                </div>
            </div>
        </div>
    </div>
    <!-- End Banner Hero -->
    
    <section id="main-section" class="container" style="height: 80vh; display: block;">
        <div class="row text-center">
            <div class="col-lg-6 m-auto">
                <div class="d-flex flex-column align-items-center mt-4">
                    <div class="input-group mb-2">
                        <h3 class="h3">Ubicaciones donde prestas servicio</h3>
                    </div>
                    <div id="ubicacion-error-message" class="error-message-ubicacion"></div>
                    <div class="input-group mb-2">
                        <span class="input-group-text" style="background-color: white; border: none;"><i class="fas fa-map"></i></span>
                        <input type="text" class="form-control" id="region" placeholder="Buscar región" autocomplete="off">
                    </div>
                    <div class="input-group mb-2">
                        <span class="input-group-text" style="background-color: white; border: none;"><i class="fas fa-map-marker-alt"></i></span>
                        <input type="text" class="form-control" id="comuna" placeholder="Buscar comuna" autocomplete="off" disabled>
                    </div>
                    <button id="guardar_ubicacion" class="btn btn-secondary" style="width: 90%; height: 50px; background-color: white!important; color: black!important; margin-top: 3%; display: block;">Guardar ubicación</button>
                    <button id="agregar_ubicacion" class="btn btn-secondary" style="width: 90%; height: 50px; background-color: white!important; color: black!important; margin-top: 3%; display: none;">Agregar/cambiar ubicación</button>
                    <button id="continuar_registro_4" class="btn btn-secondary" style="width: 90%; height: 50px; background-color: white; color: black; margin-top: 3%; display: none;">Continuar registro</button>
                    <button id="cancelar_ubicacion" class="btn btn-secondary" style="width: 90%; height: 50px; background-color: white; color: black; margin-top: 3%; display: none;">Cancelar</button>
                </div>
            </div>
        </div>
        <div><p id="pre-footer">*La información podrá ser editada en tu perfil</p></div> 
        <div id="footer" class="bg-success py-3"></div>
    </section>

    <section id="container-regiones" style="height: 80vh; display: none; overflow: auto;">
        <div class="row">
            <div class="d-flex flex-column align-items-start mt-4">
                <div style="width: 100%;">
                    <div id="regiones-container" class="input-group-append" style="display: flex; flex-direction: column; align-items: flex-start; width: 100%; margin-left: 5%;"></div>
                </div>
            </div>
        </div>
    </section>

    <section id="container-comunas" style="height: 80vh; display: none; overflow: auto;">
        <div class="row">
          <div class="d-flex flex-column align-items-start mt-4">
            <div style="width: 100%;">
              <div id="comunas-container" class="input-group-append" style="display: flex; flex-direction: column; align-items: flex-start; width: 100%; margin-left: 5%;"></div>
            </div>
            <div class="input-group mb-2">
                <div style="text-align: center; margin-bottom: -40px; margin-top: 35px;">
                    <button id="confirmar_comunas" class="btn btn-secondary" style="width: 45%; height: 40px; background-color: white; color: black;">Confirmar</button>
                </div>
            </div>
          </div>
        </div>
    </section>
    
    <script>
        // Agregar un evento de carga de la página
        window.addEventListener('load', () => {
            localStorage.removeItem('ubicaciones');
        });
        document.getElementById('region').addEventListener('click', () => {
        // Fetch the regiones-comunas.json file
        fetch('../../json/comunas-regiones.json')
            .then(response => response.json())
            .then(data => {
                // Get the list of regions from the data
                const regiones = data.regiones.map(item => item.region);

                // Create a label for each region and append it to the regiones-container
                const regionesContainer = document.getElementById('regiones-container');
                regiones.forEach(region => {
                    const label = document.createElement('label');
                    label.classList.add('mr-2');
                    label.style.textAlign = 'left';
                    label.style.width = '100%';
                    label.innerHTML = `<span><i class="fas fa-map"></i></span> ${region}`;
                    label.addEventListener('click', () => {
                        // Update the region input value
                        document.getElementById('region').value = region;
                        // Obtener el elemento de entrada de texto
                        document.getElementById('comuna').disabled = false;
                        document.getElementById('comuna').value = "";
                        // Show the main section and hide the container-regiones section
                        document.getElementById('main-section').style.display = 'block';
                        document.getElementById('container-regiones').style.display = 'none';
                    });
                    regionesContainer.appendChild(label);
                    const br = document.createElement('br');
                    regionesContainer.appendChild(br);
                });
                // Hide the main-container and show the container-regiones
                document.getElementById('main-section').style.display = 'none';
                document.getElementById('container-regiones').style.display = 'block';
            })
            .catch(error => console.error('Error fetching regiones-comunas.json:', error));
    });
    </script>
    
    <script>
        let selectedComunas = [];
        document.getElementById('comuna').addEventListener('click', () => {
        // Fetch the regiones-comunas.json file
        fetch('../../json/comunas-regiones.json')
            .then(response => response.json())
            .then(data => {
            // Get the selected region from the input field
            //const selectedRegion = document.getElementById('region').value;
            const selectedRegion = document.getElementById('region').value.split(', ').pop();
            // Find the communes for the selected region
            const selectedComunes = data.regiones.find(item => item.region === selectedRegion).comunas;

            // Clear the previous communes
            const comunasContainer = document.getElementById('comunas-container');
            comunasContainer.innerHTML = '';

            // Crear una etiqueta para cada comuna y agregarla al contenedor de comunas
            selectedComunes.forEach(comuna => {
            const label = document.createElement('label');
            label.classList.add('mr-2');
            label.style.textAlign = 'left';
            label.style.width = '100%';
            label.innerHTML = `<span><i class="fas fa-map-marker-alt"></i></span> ${comuna}`;
            label.addEventListener('click', () => {
                // Actualizar el valor del input de comuna cuando se hace clic en una comuna
                if (label.style.backgroundColor === 'green') {
                    label.style.backgroundColor = 'transparent';
                    selectedComunas = selectedComunas.filter(c => c !== comuna);
                    // Actualizar el valor del input de comuna
                    document.getElementById('comuna').value = selectedComunas.join(', ');
                } else {
                    label.style.backgroundColor = 'green';
                    selectedComunas.push(comuna);
                    // Actualizar el valor del input de comuna
                    document.getElementById('comuna').value = selectedComunas.join(', ');
                }
            }); 
            // Verificar si la comuna está seleccionada y establecer el color verde
            if (selectedComunas.includes(comuna)) {
                label.style.backgroundColor = 'green';
            }
            comunasContainer.appendChild(label);
            const br = document.createElement('br');
            comunasContainer.appendChild(br);
        });
            // Show the container-comunas section
            document.getElementById('main-section').style.display = 'none';
            document.getElementById('container-comunas').style.display = 'block';
            })
            .catch(error => console.error('Error fetching regiones-comunas.json:', error));
        });

        document.getElementById('confirmar_comunas').addEventListener('click', () => {
        if (selectedComunas.length > 0) {
            
            document.getElementById('main-section').style.display = 'block';
            document.getElementById('container-comunas').style.display = 'none';
            // Aquí puedes guardar las comunas seleccionadas
            console.log('Comunas seleccionadas:', selectedComunas);
            // Ocultar el mensaje de error
            //document.getElementById('ubicacion-error-message').textContent = '';
            // Actualizar el input de region
            updateRegionInput();
        } else {
        // Mostrar un mensaje de error
        //document.getElementById('ubicacion-error-message').textContent = 'Debe seleccionar al menos una comuna.';
        }
    });

    // Agrega un event listener al botón "guardar_ubicacion"
    document.getElementById('guardar_ubicacion').addEventListener('click', () => {
    saveUbicacionesToLocalStorage();
    });

    function updateRegionInput() {
    // Fetch the regiones-comunas.json file
    fetch('../../json/comunas-regiones.json')
        .then(response => response.json())
        .then(data => {
        // Get the list of regions from the data
        const regionesSet = new Set();
        selectedComunas.forEach(comuna => {
            const region = data.regiones.find(item => item.comunas.includes(comuna)).region;
            regionesSet.add(region);
        });
        const regiones = Array.from(regionesSet);

        // Update the region input value
        document.getElementById('region').value = regiones.join(', ');
        })
        .catch(error => console.error('Error fetching regiones-comunas.json:', error));
    }

    function saveUbicacionesToLocalStorage() {
    // Fetch the regiones-comunas.json file
    fetch('../../json/comunas-regiones.json')
        .then(response => response.json())
        .then(data => {
        // Get the list of regions from the data
        const regionesSet = new Set();
        const ubicaciones = {};
        selectedComunas.forEach(comuna => {
            const region = data.regiones.find(item => item.comunas.includes(comuna)).region;
            regionesSet.add(region);
            if (!ubicaciones[region]) {
            ubicaciones[region] = [];
            }
            ubicaciones[region].push(comuna);
        });
        const regiones = Array.from(regionesSet);

        // Guardar la región y las comunas en el localStorage
        localStorage.setItem('ubicaciones', JSON.stringify(ubicaciones));
        })
        .catch(error => console.error('Error fetching regiones-comunas.json:', error));
    }
        
    </script>
    
    <script>
        // Obtener los elementos necesarios
        const regionInput = document.getElementById('region');
        const comunaInput = document.getElementById('comuna');
        const guardarUbicacionBtn = document.getElementById('guardar_ubicacion');
        const agregarUbicacionBtn = document.getElementById('agregar_ubicacion');
        const cancelarUbicacionBtn = document.getElementById('cancelar_ubicacion');
        const continuarRegistroBtn = document.getElementById('continuar_registro_4');

        // Agregar el evento de clic al botón "guardar_ubicacion"
        guardarUbicacionBtn.addEventListener('click', () => {
            // Verificar si los inputs de "region" y "comuna" no están vacíos
            if (regionInput.value.trim() !== '' && comunaInput.value.trim() !== '') {
                // Ocultar el botón "guardar_ubicacion"
                guardarUbicacionBtn.style.display = 'none';
                cancelarUbicacionBtn.style.display = 'none';

                // Mostrar los botones "agregar_ubicacion" y "continuar_registro_4"
                agregarUbicacionBtn.style.display = 'inline-block';
                continuarRegistroBtn.style.display = 'inline-block';
                regionInput.value = "";
                regionInput.disabled = true;
                comunaInput.value = "";
                comunaInput.disabled = true;
            }
        });

        // Agregar el evento de clic al botón "agregar_ubicacion"
        agregarUbicacionBtn.addEventListener('click', () => {
            // Mostrar los botones "guardar_ubicacion" y "cancelar_ubicacion"

            continuarRegistroBtn.style.display = 'none';

            guardarUbicacionBtn.style.display = 'inline-block';
            cancelarUbicacionBtn.style.display = 'inline-block';

            // Ocultar el botón "agregar_ubicacion"
            agregarUbicacionBtn.style.display = 'none';

            // Habilitar los inputs de "region" y "comuna"
            regionInput.disabled = false;
            comunaInput.disabled = true;
        });

        // Agregar el evento de clic al botón "cancelar_ubicacion"
        cancelarUbicacionBtn.addEventListener('click', () => {
            // Ocultar los botones "guardar_ubicacion" y "cancelar_ubicacion"
            guardarUbicacionBtn.style.display = 'none';
            cancelarUbicacionBtn.style.display = 'none';

            // Mostrar el botón "agregar_ubicacion"
            agregarUbicacionBtn.style.display = 'inline-block';

            // Mostrar el botón "continuar_registro_4"
            continuarRegistroBtn.style.display = 'inline-block';

            // Limpiar y deshabilitar los inputs de "region" y "comuna"
            regionInput.value = '';
            regionInput.disabled = true;
            comunaInput.value = '';
            comunaInput.disabled = true;
        });
    </script>

    <script>
        //Lógica flecha
        document.querySelector('.flecha-atras').addEventListener('click', function() {
            window.location.href = 'registro_paso_3.html';
        });
        //Lógica del footer
        document.addEventListener('DOMContentLoaded', function() {
            const animatedSections = document.querySelectorAll('.animate-section');
            const footer = document.getElementById('footer');

            function showFooter() {
                footer.style.opacity = '1';
                footer.style.transform = 'translateY(0)';
            }

            animatedSections.forEach(section => {
                section.addEventListener('animationend', showFooter);
            });
        });
    </script>

    <!-- Start Script -->
    <script src="../../js/jquery-3.7.1.min.js"></script>
    <script src="../../js/jquery-migrate-1.2.1.min.js"></script>
    <script src="../../js/bootstrap.bundle.min.js"></script>
    <script src="../../js/templatemo.js"></script>
    <script src="../../js/custom.js"></script>
    <script src="../../json/comunas-regiones.json"></script>
    <script src="../../js/registro/prestador_paso_4.js"></script>
    
    <!-- End Script -->
</body>
</html>